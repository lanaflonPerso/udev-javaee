
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>L’héritage avec JPA &#8212; documentation Java EE 1.0</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="l-heritage-avec-jpa">
<h1>L’héritage avec JPA<a class="headerlink" href="#l-heritage-avec-jpa" title="Lien permanent vers ce titre">¶</a></h1>
<p>JPA offre plusieurs stratégies pour associer une relation d’héritage dans le
modèle objet avec une représentation dans le modèle relationnel de données.</p>
<p>Pour décrire la relation d’héritage avec JPA, on utilise l’annotation <a class="reference external" href="https://docs.oracle.com/javaee/7/api/javax/persistence/Inheritance.html">&#64;Inheritance</a>
ou <a class="reference external" href="https://docs.oracle.com/javaee/7/api/javax/persistence/MappedSuperclass.html">&#64;MappedSuperclass</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Pour une présentation complète de l’héritage dans JPA, reportez-vous
au <a class="reference external" href="https://en.wikibooks.org/wiki/Java_Persistence/Inheritance">Wikibook</a>.</p>
</div>
<div class="section" id="l-annotation-inheritance">
<h2>L’annotation &#64;Inheritance<a class="headerlink" href="#l-annotation-inheritance" title="Lien permanent vers ce titre">¶</a></h2>
<p>L’annotation <a class="reference external" href="https://docs.oracle.com/javaee/7/api/javax/persistence/Inheritance.html">&#64;Inheritance</a> permet d’indiquer qu’il existe une relation d’héritage
dans le modèle objet et dans le modèle relationnel. Comme il existe plusieurs
façon de représenter un héritage de données dans le modèle relationnel,
l’annotation <a class="reference external" href="https://docs.oracle.com/javaee/7/api/javax/persistence/Inheritance.html">&#64;Inheritance</a> dispose de l’attribut <code class="docutils literal"><span class="pre">strategy</span></code> pour préciser
la stratégie utilisée dans le modèle de données. Cette stratégie est une énumération
du type <a class="reference external" href="https://docs.oracle.com/javaee/7/api/javax/persistence/InheritanceType.html">InheritanceType</a> et accepte les valeurs :</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">SINGLE_TABLE</span></code></dt>
<dd>l’héritage est représenté par une seule table en base de données</dd>
<dt><code class="docutils literal"><span class="pre">JOINED</span></code></dt>
<dd>l’héritage est représenté par une jointure entre la table de l’entité parente et la table de l’entité enfant</dd>
<dt><code class="docutils literal"><span class="pre">TABLE_PER_CLASS</span></code></dt>
<dd>l’héritage est représenté par une table par entité</dd>
</dl>
<div class="section" id="heritage-avec-une-seule-table">
<h3>Héritage avec une seule table<a class="headerlink" href="#heritage-avec-une-seule-table" title="Lien permanent vers ce titre">¶</a></h3>
<p>La stratégie <code class="docutils literal"><span class="pre">SINGLE_TABLE</span></code> permet de représenter en base de données un héritage
avec une seule table. Une colonne contiendra un identifiant pour déterminer le
type réel de la classe : on parle de la colonne <em>discriminante</em>. La table doit
contenir toutes les colonnes nécessaires pour stocker les informations de la
super classe et de l’ensemble des classes filles.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">L’inconvénient de la stratégie <code class="docutils literal"><span class="pre">SINGLE_TABLE</span></code> est qu’il n’est pas possible
d’ajouter des contraintes de type <code class="docutils literal"><span class="pre">NOT</span> <span class="pre">NULL</span></code> sur les colonnes représentant
les propriétés des classes filles.</p>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Super classe</span><a class="headerlink" href="#id2" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">io.github.spoonless.vehicule</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.DiscriminatorColumn</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Inheritance</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.InheritanceType</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Inheritance</span><span class="o">(</span><span class="n">strategy</span><span class="o">=</span><span class="n">InheritanceType</span><span class="o">.</span><span class="na">SINGLE_TABLE</span><span class="o">)</span>
<span class="nd">@DiscriminatorColumn</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;vehicule_type&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Vehicule</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span><span class="o">=</span><span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">marque</span><span class="o">;</span>

    <span class="c1">// getters/setters omis</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
<p>Dans l’exemple précédent, la colonne discriminante est donnée par l’annotation
<a class="reference external" href="https://docs.oracle.com/javaee/7/api/javax/persistence/DiscriminatorColumn.html">&#64;DiscriminatorColumn</a>. Cette colonne n’est donc pas représentée par un attribut
dans la classe.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Classe enfant</span><a class="headerlink" href="#id3" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">io.github.spoonless.vehicule</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.DiscriminatorValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@DiscriminatorValue</span><span class="o">(</span><span class="s">&quot;V&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Voiture</span> <span class="kd">extends</span> <span class="n">Vehicule</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">nbPlaces</span><span class="o">;</span>

    <span class="c1">// getters/setters omis</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Une autre classe enfant</span><a class="headerlink" href="#id4" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">io.github.spoonless.vehicule</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.DiscriminatorValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@DiscriminatorValue</span><span class="o">(</span><span class="s">&quot;M&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Moto</span> <span class="kd">extends</span> <span class="n">Vehicule</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">cylindree</span><span class="o">;</span>

    <span class="c1">// getters/setters omis</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
<p>L’annotation <a class="reference external" href="https://docs.oracle.com/javaee/7/api/javax/persistence/DiscriminatorValue.html">&#64;DiscriminatorValue</a> permet de préciser la valeur dans la colonne
discriminante qui permet d’identifier un objet du type de cette classe. Cette
valeur doit être unique pour l’ensemble des classes de l’héritage. Dans l’exemple
ci-dessus, lors de la persistance d’un objet de la classe <code class="docutils literal"><span class="pre">Voiture</span></code>, JPA positionnera
automatiquement la valeur <code class="docutils literal"><span class="pre">&quot;V&quot;</span></code> dans la colonne <code class="docutils literal"><span class="pre">vehicule_type</span></code>.</p>
<p>Pour l’exemple précédent, le schéma de base de données contiendra la table <code class="docutils literal"><span class="pre">Vehicule</span></code>
qui peut être créée comme suit :</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">create</span> <span class="k">table</span> <span class="n">Vehicule</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
    <span class="n">vehicule_type</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">marque</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">cylindree</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">nbPlaces</span> <span class="nb">int</span><span class="p">,</span>
    <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span> <span class="n">engine</span> <span class="o">=</span> <span class="n">InnoDB</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="heritage-avec-jointure-de-tables">
<h2>Héritage avec jointure de tables<a class="headerlink" href="#heritage-avec-jointure-de-tables" title="Lien permanent vers ce titre">¶</a></h2>
<p>La stratégie <code class="docutils literal"><span class="pre">JOINED</span></code> permet de représenter en base de données un héritage
avec une table par entité. Pour les classes filles, JPA réalisera une jointure
entre la table représentant l’entité et la table représentant l’entité de la
super classe. L’implémentation est très proche de celle d’un héritage avec
une seule table (seule la stratégie change) mais le schéma de la base de données
est très différent.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Super classe</span><a class="headerlink" href="#id5" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">io.github.spoonless.vehicule</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.DiscriminatorColumn</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Inheritance</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.InheritanceType</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Inheritance</span><span class="o">(</span><span class="n">strategy</span><span class="o">=</span><span class="n">InheritanceType</span><span class="o">.</span><span class="na">JOINED</span><span class="o">)</span>
<span class="nd">@DiscriminatorColumn</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;vehicule_type&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Vehicule</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span><span class="o">=</span><span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">marque</span><span class="o">;</span>

    <span class="c1">// getters/setters omis</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Classe enfant</span><a class="headerlink" href="#id6" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">io.github.spoonless.vehicule</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.DiscriminatorValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@DiscriminatorValue</span><span class="o">(</span><span class="s">&quot;V&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Voiture</span> <span class="kd">extends</span> <span class="n">Vehicule</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">nbPlaces</span><span class="o">;</span>

    <span class="c1">// getters/setters omis</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Une autre classe enfant</span><a class="headerlink" href="#id7" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">io.github.spoonless.vehicule</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.DiscriminatorValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@DiscriminatorValue</span><span class="o">(</span><span class="s">&quot;M&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Moto</span> <span class="kd">extends</span> <span class="n">Vehicule</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">cylindree</span><span class="o">;</span>

    <span class="c1">// getters/setters omis</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
<p>Dans cette configuration, JPA attend 3 tables dans le schéma de base de données
qui peuvent être créées par les instructions suivantes :</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">create</span> <span class="k">table</span> <span class="n">Vehicule</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
    <span class="n">vehicule_type</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">marque</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span> <span class="n">engine</span> <span class="o">=</span> <span class="n">InnoDB</span><span class="p">;</span>

<span class="k">create</span> <span class="k">table</span> <span class="n">Voiture</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
    <span class="n">nbPlaces</span> <span class="nb">int</span><span class="p">,</span>
    <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">references</span> <span class="n">Vehicule</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span> <span class="n">engine</span> <span class="o">=</span> <span class="n">InnoDB</span><span class="p">;</span>

<span class="k">create</span> <span class="k">table</span> <span class="n">Moto</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
    <span class="n">cylindree</span> <span class="nb">int</span><span class="p">,</span>
    <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">references</span> <span class="n">Vehicule</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span> <span class="n">engine</span> <span class="o">=</span> <span class="n">InnoDB</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="heritage-avec-une-table-par-classe">
<h2>Héritage avec une table par classe<a class="headerlink" href="#heritage-avec-une-table-par-classe" title="Lien permanent vers ce titre">¶</a></h2>
<p>La stratégie <code class="docutils literal"><span class="pre">TABLE_PER_CLASS</span></code> permet de représenter en base de données un héritage
avec une table par entité. Les attributs hérités sont répétés dans chaque table.
Ainsi, la notion d’héritage n’est pas exprimée dans le modèle relationnel de données.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Super classe</span><a class="headerlink" href="#id8" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">io.github.spoonless.vehicule</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Inheritance</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.InheritanceType</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Inheritance</span><span class="o">(</span><span class="n">strategy</span><span class="o">=</span><span class="n">InheritanceType</span><span class="o">.</span><span class="na">TABLE_PER_CLASS</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Vehicule</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span><span class="o">=</span><span class="n">GenerationType</span><span class="o">.</span><span class="na">AUTO</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">marque</span><span class="o">;</span>

    <span class="c1">// getters/setters omis</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">Classe enfant</span><a class="headerlink" href="#id9" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">io.github.spoonless.vehicule</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Voiture&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Voiture</span> <span class="kd">extends</span> <span class="n">Vehicule</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">nbPlaces</span><span class="o">;</span>

    <span class="c1">// getters/setters omis</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">Une autre classe enfant</span><a class="headerlink" href="#id10" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">io.github.spoonless.vehicule</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Moto&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Moto</span> <span class="kd">extends</span> <span class="n">Vehicule</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">cylindree</span><span class="o">;</span>

    <span class="c1">// getters/setters omis</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
<p>Dans cette configuration, JPA attend 2 tables dans le schéma de base de données
qui peuvent être créées par les instructions suivantes :</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">create</span> <span class="k">table</span> <span class="n">Voiture</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">int</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">marque</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">nbPlaces</span> <span class="nb">int</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span> <span class="n">engine</span> <span class="o">=</span> <span class="n">InnoDB</span><span class="p">;</span>

<span class="k">create</span> <span class="k">table</span> <span class="n">Moto</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">int</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">marque</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">cylindree</span> <span class="nb">int</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span> <span class="n">engine</span> <span class="o">=</span> <span class="n">InnoDB</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">La table <code class="docutils literal"><span class="pre">Vehicule</span></code> n’est pas nécessaire car la classe <code class="docutils literal"><span class="pre">Vehicule</span></code> est
abstraite. Il n’est donc pas possible de créer des entités de type <code class="docutils literal"><span class="pre">Vehicule</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>La stratégie <code class="docutils literal"><span class="pre">TABLE_PER_CLASS</span></code> est plus complexe à mettre en place pour
la gestion des clés primaires. En effet, du point de vue de JPA, les objets
de type <code class="docutils literal"><span class="pre">Voiture</span></code> et <code class="docutils literal"><span class="pre">Moto</span></code> sont également des objets de type <code class="docutils literal"><span class="pre">Voiture</span></code>.
À ce titre, il ne peut pas exister deux objets avec la même clé primaire. Mais,
comme ces objets sont représentés en base de données par deux tables différentes,
une colonne de type <code class="docutils literal"><span class="pre">AUTO_INCREMENT</span></code> en MySQL ne suffit pas à garantir qu’il
n’existe pas une voiture ayant la même clé qu’une moto.</p>
<p class="last">Avec, la stratégie <code class="docutils literal"><span class="pre">TABLE_PER_CLASS</span></code>, il n’est pas possible d’utiliser
l’annotation <a class="reference external" href="https://docs.oracle.com/javaee/7/api/javax/persistence/GeneratedValue.html">&#64;GeneratedValue</a> avec la valeur <code class="docutils literal"><span class="pre">IDENTITY</span></code>. On peut,
par exemple, utiliser une table servant à générer une séquence de clés.</p>
</div>
</div>
<div class="section" id="fusion-de-la-super-classe">
<h2>Fusion de la super classe<a class="headerlink" href="#fusion-de-la-super-classe" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il arrive parfois que la relation d’héritage n’ait pas de sens dans le modèle
relationnel. Dans ce cas, la classe parente n’est pas vraiment une entité au
sens JPA, on parle de <em>mapped superclass</em>.</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">Super classe</span><a class="headerlink" href="#id11" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">io.github.spoonless.vehicule</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.MappedSuperclass</span><span class="o">;</span>

<span class="nd">@MappedSuperclass</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Vehicule</span> <span class="o">{</span>

        <span class="nd">@Id</span>
        <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span><span class="o">=</span><span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
        <span class="kd">private</span>     <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

        <span class="kd">private</span> <span class="n">String</span> <span class="n">marque</span><span class="o">;</span>

    <span class="c1">// getters/setters omis</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
<p>La classe <code class="docutils literal"><span class="pre">Vehicule</span></code> n’est plus déclarée avec l’annotation <a class="reference external" href="https://docs.oracle.com/javaee/7/api/javax/persistence/Entity.html">&#64;Entity</a> mais
avec l’annotation <a class="reference external" href="https://docs.oracle.com/javaee/7/api/javax/persistence/MappedSuperclass.html">&#64;MappedSuperclass</a>.</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">Classe enfant</span><a class="headerlink" href="#id12" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">io.github.spoonless.vehicule</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Voiture&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Voiture</span> <span class="kd">extends</span> <span class="n">Vehicule</span> <span class="o">{</span>

        <span class="kd">private</span> <span class="kt">int</span> <span class="n">nbPlaces</span><span class="o">;</span>

    <span class="c1">// getters/setters omis</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">Une autre classe enfant</span><a class="headerlink" href="#id13" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">io.github.spoonless.vehicule</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Moto&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Moto</span> <span class="kd">extends</span> <span class="n">Vehicule</span> <span class="o">{</span>

        <span class="kd">private</span> <span class="kt">int</span> <span class="n">cylindree</span><span class="o">;</span>

    <span class="c1">// getters/setters omis</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
<p>Dans cette configuration, JPA attend 2 tables dans le schéma de base de données
qui peuvent être créées par les instructions suivantes :</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">create</span> <span class="k">table</span> <span class="n">Voiture</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">int</span> <span class="k">not</span> <span class="k">null</span> <span class="n">auto_increment</span><span class="p">,</span>
    <span class="n">marque</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">nbPlaces</span> <span class="nb">int</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span> <span class="n">engine</span> <span class="o">=</span> <span class="n">InnoDB</span><span class="p">;</span>

<span class="k">create</span> <span class="k">table</span> <span class="n">Moto</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">int</span> <span class="k">not</span> <span class="k">null</span> <span class="n">auto_increment</span><span class="p">,</span>
    <span class="n">marque</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">cylindree</span> <span class="nb">int</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span> <span class="n">engine</span> <span class="o">=</span> <span class="n">InnoDB</span><span class="p">;</span>
</pre></div>
</div>
<p>Contrairement au cas précédent, l’utilisation de <a class="reference external" href="https://docs.oracle.com/javaee/7/api/javax/persistence/MappedSuperclass.html">&#64;MappedSuperclass</a> implique qu’il
n’existe pas de relation entre les classes filles pour JPA. Comme la super classe
n’est pas un entité, il n’est pas possible d’effectuer des requêtes sur la super classe.</p>
</div>
<div class="section" id="exercice">
<h2>Exercice<a class="headerlink" href="#exercice" title="Lien permanent vers ce titre">¶</a></h2>
<div class="topic">
<p class="topic-title first">Gestion des examens</p>
<p>On souhaite mettre en place un système de sauvegarde des notes aux examens des étudiants.</p>
<p>Un résultat d’examen contient le code de l’examen, la date de passage et le nom de l’étudiant.
Parmi les examens, on distingue :</p>
<ul class="simple">
<li>un contrôle pour lequel l’étudiant a une note sur 20</li>
<li>un projet pour lequel l’étudiant a une note d’oral et d’écrit sur 10. La note du projet
correspond à la somme de ces deux notes.</li>
</ul>
<p>Créez les entités et une classe Java permettant :</p>
<ul class="simple">
<li>d’ajouter un résultat d’un contrôle ou d’un projet dans une base de données.</li>
<li>de récupérer la liste des objets contenant les notes d’un étudiant pour une période donnée</li>
<li>de connaître la moyenne d’un étudiant</li>
<li>de connaître la moyenne d’un contrôle ou d’un projet</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Une classe contenant des méthodes pour interagir avec la base de données
est souvent qualifiée de DAO (<em>Data Access Object</em>).</p>
</div>
<div class="admonition-template-de-projet-jpa admonition">
<p class="first admonition-title">Template de projet JPA</p>
<p class="last">Vous pouvez <a class="reference download internal" href="../_downloads/template-orm.zip" download=""><code class="xref download docutils literal"><span class="pre">télécharger</span> <span class="pre">le</span> <span class="pre">projet</span> <span class="pre">d'exemple</span></code></a>.
Il s’agit d’un projet Maven avec une dépendance vers Hibernate et le pilote JDBC MySQL.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Java EE</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../environnement_developpement.html">L’environnement de développement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../premiere_application.html">Une première application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maven.html">Introduction à Maven</a></li>
<li class="toctree-l1"><a class="reference internal" href="../servlet.html">Les Servlets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conteneur_web.html">Le conteneur Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="../attributs_web.html">Les attributs d’une application Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jsp.html">JSP : Java Server Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../request_dispatcher.html">RequestDispatcher et MVC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web_listeners_filters.html">Web listeners et filtres</a></li>
<li class="toctree-l1"><a class="reference internal" href="jdbc_webapp.html">JDBC dans une application Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="ejb.html">Les EJB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jsf.html">Java Server Faces (JSF)</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="http://docs.oracle.com/javase/8/docs/">Documentation Java</a></li>
    
    <li class="toctree-l1"><a href="http://docs.oracle.com/javase/8/docs/api/index.html?overview-summary.html">API Java</a></li>
    
    <li class="toctree-l1"><a href="https://docs.oracle.com/javaee/7/api/">API Java EE</a></li>
    
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;
<a ref="author" href="mailto:dagaydevel@free.fr">David Gayerie</a>
<a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/fr/"><img alt="Licence Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/3.0/fr/80x15.png" /></a>
.
      
    </div>

    

    
  </body>
</html>