
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Les relations avec JPA &#8212; documentation Java EE 1.0</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="les-relations-avec-jpa">
<h1>Les relations avec JPA<a class="headerlink" href="#les-relations-avec-jpa" title="Lien permanent vers ce titre">¶</a></h1>
<p>Une des fonctionnalités majeures des ORM est de gérer les relations
entre objets comme des relations entre tables dans un modèle de base de
données relationnelle. JPA définit des modèles de relation qui peuvent
être déclarés par annotation.</p>
<p>Les relations sont spécifiées par les annotations&nbsp;: <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/OneToOne.html">&#64;OneToOne</a>, <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/ManyToOne.html">&#64;ManyToOne</a>,
<a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/OneToMany.html">&#64;OneToMany</a>, <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/ManyToMany.html">&#64;ManyToMany</a>.</p>
<p>Pour une présentation approfondie des relations dans JPA, reportez-vous
au <a class="reference external" href="http://en.wikibooks.org/wiki/Java_Persistence/Relationships">Wikibook</a>.</p>
<div class="section" id="la-relation-1-1-one-to-one">
<h2>La relation 1:1 (one to one)<a class="headerlink" href="#la-relation-1-1-one-to-one" title="Lien permanent vers ce titre">¶</a></h2>
<p>L’annotation <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/OneToOne.html">&#64;OneToOne</a> définit une relation 1:1 entre deux entités.
Si cette relation n’est pas
forcément très courante dans un modèle relationnel de base de données,
elle se rencontre très souvent dans une modèle objet.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Exemple de relation OneToOne</span><a class="headerlink" href="#id1" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToOne</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Individu</span> <span class="o">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="nd">@OneToOne</span>
  <span class="kd">private</span> <span class="n">Abonnement</span> <span class="n">abonnement</span><span class="o">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">La classe associée dans la relation OneToOne</span><a class="headerlink" href="#id2" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Abonnement</span> <span class="o">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<p>L’annotation <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/OneToOne.html">&#64;OneToOne</a> implique que la table <code class="docutils literal"><span class="pre">Individu</span></code> contient
une colonne qui est une clé étrangère contenant la clé d’un abonnement.
Par défaut, JPA s’attend à ce que cette colonne se nomme ABONNEMENT_ID,
mais il est possible de changer ce nom grâce à l’annotation
<a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/JoinColumn.html">&#64;JoinColumn</a>&nbsp;:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Déclaration de la clé étrangère</span><a class="headerlink" href="#id3" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinColumn</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToOne</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Individu</span> <span class="o">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="nd">@OneToOne</span>
  <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;abonnement_fk&quot;</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">Abonnement</span> <span class="n">abonnement</span><span class="o">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="la-relation-n-1-many-to-one">
<h3>La relation n:1 (many to one)<a class="headerlink" href="#la-relation-n-1-many-to-one" title="Lien permanent vers ce titre">¶</a></h3>
<p>L’annotation <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/ManyToOne.html">&#64;ManyToOne</a> définit une relation n:1 entre deux entités.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Exemple de relation ManyToOne</span><a class="headerlink" href="#id4" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToOne</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Individu</span> <span class="o">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="nd">@ManyToOne</span>
  <span class="kd">private</span> <span class="n">Societe</span> <span class="n">societe</span><span class="o">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">La classe associée dans la relation ManyToOne</span><a class="headerlink" href="#id5" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Societe</span> <span class="o">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<p>L’annotation <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/ManyToOne.html">&#64;ManyToOne</a> implique que la table <code class="docutils literal"><span class="pre">Individu</span></code> contient
une colonne qui est une clé étrangère contenant la clé d’une société.
Par défaut, JPA s’attend à ce que cette colonne se nomme SOCIETE_ID,
mais il est possible de changer ce nom grâce à l’annotation <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/JoinColumn.html">&#64;JoinColumn</a>.
Plutôt que par une colonne, il est également possible d’indiquer à JPA
qu’il doit passer par une table d’association pour établir la relation
entre les deux entités avec l’annotation <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/JoinTable.html">&#64;JoinTable</a>&nbsp;:</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Déclaration d’une table d’association</span><a class="headerlink" href="#id6" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinColumn</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinTable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToOne</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Individu</span> <span class="o">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="nd">@ManyToOne</span>
  <span class="c1">// déclaration d&#39;une table d&#39;association</span>
  <span class="nd">@JoinTable</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;societe_individu&quot;</span><span class="o">,</span>
             <span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;individu_id&quot;</span><span class="o">),</span>
             <span class="n">inverseJoinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;societe_id&quot;</span><span class="o">))</span>
  <span class="kd">private</span> <span class="n">Societe</span> <span class="n">societe</span><span class="o">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="la-relation-1-n-one-to-many">
<h2>La relation 1:n (one to many)<a class="headerlink" href="#la-relation-1-n-one-to-many" title="Lien permanent vers ce titre">¶</a></h2>
<p>L’annotation <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/OneToMany.html">&#64;OneToMany</a> définit une relation 1:n entre deux entités.
Cette annotation ne peut être utilisée qu’avec une collection d’éléments
puisqu’elle implique qu’il peut y avoir plusieurs entités associées.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Exemple de relation OneToMany</span><a class="headerlink" href="#id7" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToMany</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Societe</span> <span class="o">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="nd">@OneToMany</span>
  <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Individu</span><span class="o">&gt;</span> <span class="n">employes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">La classe associée dans la relation OneToMany</span><a class="headerlink" href="#id8" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Individu</span> <span class="o">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<p>L’annotation <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/OneToMany.html">&#64;OneToMany</a> implique que la table <code class="docutils literal"><span class="pre">Individu</span></code> contient
une colonne qui est une clé étrangère contenant la clé d’une société.
Par défaut, JPA s’attend à ce que cette colonne se nomme SOCIETE_ID,
mais il est possible de changer ce nom grâce à l’annotation <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/JoinColumn.html">&#64;JoinColumn</a>.
Il est également possible d’indiquer à JPA qu’il doit passer par une
table d’association pour établir la relation entre les deux entités avec
l’annotation <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/JoinTable.html">&#64;JoinTable</a>.
Ainsi, <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/ManyToOne.html">&#64;ManyToOne</a> fonctionne exactement comme <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/OneToMany.html">&#64;OneToMany</a> sauf
que cette annotation porte sur l’autre côté de la relation.</p>
</div>
<div class="section" id="la-relation-n-n-many-to-many">
<h2>La relation n:n (many to many)<a class="headerlink" href="#la-relation-n-n-many-to-many" title="Lien permanent vers ce titre">¶</a></h2>
<p>L’annotation <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/ManyToMany.html">&#64;ManyToMany</a>
définit une relation n:n entre deux entités. Cette annotation ne peut
être utilisée qu’avec une collection d’éléments puisqu’elle implique
qu’il peut y avoir plusieurs entités associées.</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">Exemple de relation ManyToMany</span><a class="headerlink" href="#id9" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToMany</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Individu</span> <span class="o">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="nd">@ManyToMany</span>
  <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Individu</span><span class="o">&gt;</span> <span class="n">enfants</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<p>L’annotation <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/ManyToMany.html">&#64;ManyToMany</a> implique qu’il existe une table
d’association <code class="docutils literal"><span class="pre">Individu_Individu</span></code> qui contient les clés étrangères
<code class="docutils literal"><span class="pre">INDIVIDU_ID</span></code> et <code class="docutils literal"><span class="pre">ENFANTS_ID</span></code> permettant de modéliser la relation.
Il est possible de décrire explicitement la relation grâce à l’annotation
<a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/JoinTable.html">&#64;JoinTable</a>&nbsp;:</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">Déclaration de la table d’association</span><a class="headerlink" href="#id10" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinColumn</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinTable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToMany</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Individu</span> <span class="o">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="nd">@ManyToMany</span>
  <span class="nd">@JoinTable</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;ParentEnfant&quot;</span><span class="o">,</span>
             <span class="n">joinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;parent_id&quot;</span><span class="o">),</span>
             <span class="n">inverseJoinColumns</span> <span class="o">=</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;enfant_id&quot;</span><span class="o">))</span>
  <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Individu</span><span class="o">&gt;</span> <span class="n">enfants</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="les-relations-bi-directionnelles">
<h2>Les relations bi-directionnelles<a class="headerlink" href="#les-relations-bi-directionnelles" title="Lien permanent vers ce titre">¶</a></h2>
<p>Parfois, il est nécessaire de construire un lien entre deux objets qui
soit navigables dans les deux sens. D’un point de vue objet, cela
signifie que chaque objet dispose d’un attribut pointant sur l’autre
instance. Mais d’un point de vue du schéma de base de données
relationnelle, il s’agit du même lien. Avec JPA, il est possible de
qualifier une relation entre deux objets comme étant une relation
inverse grâce à l’attribut <code class="docutils literal"><span class="pre">mappedBy</span></code> de l’annotation indiquant le
type de relation.</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">Exemple d’une relation bi-directionnelle avec <code class="docutils literal"><span class="pre">mappedBy</span></code></span><a class="headerlink" href="#id11" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToMany</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Individu</span> <span class="o">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="nd">@ManyToMany</span>
  <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Individu</span><span class="o">&gt;</span> <span class="n">enfants</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

  <span class="nd">@ManyToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">&quot;enfants&quot;</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Individu</span><span class="o">&gt;</span> <span class="n">parents</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<p>Dans l’exemple précédent, la liste des <code class="docutils literal"><span class="pre">enfants</span></code> représente bien une
relation entre plusieurs instances de la classe Individu et la liste
<code class="docutils literal"><span class="pre">parents</span></code> représente la relation inverse. Pour le spécifier à JPA, on
utilise l’attribut <code class="docutils literal"><span class="pre">mappedBy</span></code> de l’annotation <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/ManyToMany.html">&#64;ManyToMany</a> pour
indiquer sur l’attribut représentant la relation inverse, le nom de
l’attribut modélisant la relation principale.</p>
</div>
<div class="section" id="la-propagation-en-cascade">
<h2>La propagation en cascade<a class="headerlink" href="#la-propagation-en-cascade" title="Lien permanent vers ce titre">¶</a></h2>
<p>Avec JPA, il est possible de propager des modifications à tout ou partie
des entités liées. Les annotations permettant de spécifier une relation
possèdent un attribut <code class="docutils literal"><span class="pre">cascade</span></code> permettant de spécifier les opérations
concernées&nbsp;: <code class="docutils literal"><span class="pre">ALL</span></code>, <code class="docutils literal"><span class="pre">DETACH</span></code>, <code class="docutils literal"><span class="pre">MERGE</span></code>, <code class="docutils literal"><span class="pre">PERSIST</span></code>, <code class="docutils literal"><span class="pre">REFRESH</span></code> ou
<code class="docutils literal"><span class="pre">REMOVE</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">Exemple d’opérations en cascade</span><a class="headerlink" href="#id12" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.CascadeType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToOne</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Individu</span> <span class="o">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">cascade</span> <span class="o">=</span> <span class="o">{</span> <span class="n">CascadeType</span><span class="o">.</span><span class="na">PERSIST</span><span class="o">,</span> <span class="n">CascadeType</span><span class="o">.</span><span class="na">MERGE</span> <span class="o">})</span>
  <span class="kd">private</span> <span class="n">Societe</span> <span class="n">societe</span><span class="o">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<p>Dans l’exemple précédent, on précise que l’instance de société doit être
enregistrée en base si nécessaire au moment où l’instance d’Individu
sera elle-même enregistrée. De plus, lors d’un appel à merge pour une
instance d’Individu, un merge sera automatiquement realisé sur
l’instance de l’attribut société.</p>
</div>
<div class="section" id="fetch-lazy-ou-fetch-eager">
<h2>Fetch lazy ou fetch eager<a class="headerlink" href="#fetch-lazy-ou-fetch-eager" title="Lien permanent vers ce titre">¶</a></h2>
<p>Lorsque JPA doit charger une entité depuis la base de données (qu’il
s’agisse d’une appel à <code class="docutils literal"><span class="pre">EntityManager.find(...)</span></code> ou d’une requête), la
question est de savoir quelles informations doivent être chargées.
Doit-il charger tous les attributs d’une entité&nbsp;? Parmi ces attributs,
doit-il charger les entités qui sont en relation avec l’entité chargée ?
Ces questions sont importantes, car la façon d’y répondre peut avoir un
impact sur les performances de l’application.</p>
<p>Dans JPA, l’opération de chargement d’une entité depuis la base de
données est appelée <strong>fetch</strong>. Un fetch peut avoir deux stratégies&nbsp;:
<strong>eager</strong> ou <strong>lazy</strong> (que l’on peut traduire respectivement et
approximativement par <em>chargement immédiat</em> et <em>chargement différé</em>). On
peut décider de la stratégie pour chaque membre de la classe grâce à
l’attribut <code class="docutils literal"><span class="pre">fetch</span></code> présent sur les annotations <a class="reference external" href="https://docs.oracle.com/javaee/7/api/javax/persistence/Basic.html">&#64;Basic</a>, <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/OneToOne.html">&#64;OneToOne</a>,
<a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/ManyToOne.html">&#64;ManyToOne</a>, <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/OneToMany.html">&#64;OneToMany</a> et <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/ManyToMany.html">&#64;ManyToMany</a>.</p>
<ul class="simple">
<li><strong>eager</strong> signifie que l’information doit être chargée
sytématiquement lorsque l’entité est chargée. Cette stratégie est
appliquée par défaut pour <a class="reference external" href="https://docs.oracle.com/javaee/7/api/javax/persistence/Basic.html">&#64;Basic</a>, <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/OneToOne.html">&#64;OneToOne</a> et <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/ManyToOne.html">&#64;ManyToOne</a>.</li>
<li><strong>lazy</strong> signifie que l’information ne sera chargée qu’à la demande
(par exemple lorsque la méthode <code class="docutils literal"><span class="pre">get</span></code> de l’attribut sera appelée).
Cette stratégie est appliquée par défaut pour <a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/OneToMany.html">&#64;OneToMany</a> et
<a class="reference external" href="http://docs.oracle.com/javaee/7/api/javax/persistence/ManyToMany.html">&#64;ManyToMany</a>.</li>
</ul>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">Exemple d’utilisation de fetch lazy</span><a class="headerlink" href="#id13" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">javax.persistence.Basic</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.FetchType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Lob</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToOne</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Individu</span> <span class="o">{</span>

  <span class="nd">@Id</span>
  <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="n">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
  <span class="kd">private</span> <span class="n">Societe</span> <span class="n">societe</span><span class="o">;</span>

  <span class="cm">/*</span>
<span class="cm">   * Stocke la photo d&#39;identité sous une forme binaire. Comme l&#39;information peut être</span>
<span class="cm">   * volumineuse, on déclare un fetch lazy pour ne déclencher le chargement qu&#39;à l&#39;appel</span>
<span class="cm">   * de getPhoto(), c&#39;est-à-dire quand l&#39;application en a vraiment besoin.</span>
<span class="cm">   */</span>
  <span class="nd">@Lob</span>
  <span class="nd">@Basic</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="n">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
  <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">photo</span><span class="o">;</span>

  <span class="c1">// getters et setters omis ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Exécute une requête de la forme : SELECT i.id FROM Individu i WHERE i.id = ?</span>
<span class="c1">// Un appel à la méthode find ne charge pas les attributs marqués avec un fetch lazy.</span>
<span class="n">Individu</span> <span class="n">persistedIndividu</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Individu</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">individuId</span><span class="o">);</span>

<span class="c1">// Exécute une requête de la forme : SELECT i.photo FROM Individu i WHERE i.id = ?</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">photo</span> <span class="o">=</span> <span class="n">persistedIndividu</span><span class="o">.</span><span class="na">getPhoto</span><span class="o">();</span>

<span class="c1">// Exécute une requête de la forme :  SELECT * FROM Societe WHERE id = ?</span>
<span class="n">Societe</span> <span class="n">societe</span> <span class="o">=</span> <span class="n">persistedIndividu</span><span class="o">.</span><span class="na">getSociete</span><span class="o">();</span>
</pre></div>
</div>
<p>La définition des stratégies de fetch est une partie importante du
tuning dans le développement d’une application utilisant JPA.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Java EE</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../environnement_developpement.html">L’environnement de développement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../premiere_application.html">Une première application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maven.html">Introduction à Maven</a></li>
<li class="toctree-l1"><a class="reference internal" href="../servlet.html">Les Servlets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conteneur_web.html">Le conteneur Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="../attributs_web.html">Les attributs d’une application Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jsp.html">JSP : Java Server Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../request_dispatcher.html">RequestDispatcher et MVC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web_listeners_filters.html">Web listeners et filtres</a></li>
<li class="toctree-l1"><a class="reference internal" href="jdbc_webapp.html">JDBC dans une application Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="ejb.html">Les EJB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jsf.html">Java Server Faces (JSF)</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="http://docs.oracle.com/javase/8/docs/">Documentation Java</a></li>
    
    <li class="toctree-l1"><a href="http://docs.oracle.com/javase/8/docs/api/index.html?overview-summary.html">API Java</a></li>
    
    <li class="toctree-l1"><a href="https://docs.oracle.com/javaee/7/api/">API Java EE</a></li>
    
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;
<a ref="author" href="mailto:dagaydevel@free.fr">David Gayerie</a>
<a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/fr/"><img alt="Licence Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/3.0/fr/80x15.png" /></a>
.
      
    </div>

    

    
  </body>
</html>